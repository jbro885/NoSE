<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: NoSE::IndexEnumerator
  
    &mdash; Documentation by YARD 0.9.25
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "NoSE::IndexEnumerator";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (I)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../NoSE.html" title="NoSE (module)">NoSE</a></span></span>
     &raquo; 
    <span class="title">IndexEnumerator</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: NoSE::IndexEnumerator
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">NoSE::IndexEnumerator</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/nose/enumerator.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Produces potential indices to be used in schemas</p>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#combine_indexes-instance_method" title="#combine_indexes (instance method)">#<strong>combine_indexes</strong>(indexes)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Combine the data of indices based on matching hash fields.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#eq_choices-instance_method" title="#eq_choices (instance method)">#<strong>eq_choices</strong>(graph, eq)  &#x21d2; Array&lt;Array&gt; </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get all possible choices of fields to use for equality.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#extra_choices-instance_method" title="#extra_choices (instance method)">#<strong>extra_choices</strong>(graph, select, eq, range)  &#x21d2; Array&lt;Array&gt; </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get fields which should be included in an index for the given graph.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#generate_index-instance_method" title="#generate_index (instance method)">#<strong>generate_index</strong>(hash, order, extra, graph)  &#x21d2; Index </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Generate a new index and ignore if invalid.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#indexes_for_graph-instance_method" title="#indexes_for_graph (instance method)">#<strong>indexes_for_graph</strong>(graph, select, eq, range)  &#x21d2; Array&lt;Index&gt; </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get all possible indices which jump a given piece of a query graph.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#indexes_for_query-instance_method" title="#indexes_for_query (instance method)">#<strong>indexes_for_query</strong>(query)  &#x21d2; Array&lt;Index&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Produce all possible indices for a given query.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#indexes_for_workload-instance_method" title="#indexes_for_workload (instance method)">#<strong>indexes_for_workload</strong>(additional_indexes = [], by_id_graph = false)  &#x21d2; Set&lt;Index&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Produce all possible indices for a given workload.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(workload)  &#x21d2; IndexEnumerator </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of IndexEnumerator.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#support_indexes-instance_method" title="#support_indexes (instance method)">#<strong>support_indexes</strong>(indexes, by_id_graph)  &#x21d2; Array&lt;Index&gt; </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Produce the indexes necessary for support queries for these indexes.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(workload)  &#x21d2; <tt><span class='object_link'><a href="" title="NoSE::IndexEnumerator (class)">IndexEnumerator</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a new instance of IndexEnumerator.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8
9
10
11
12</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/enumerator.rb', line 8</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_workload'>workload</span><span class='rparen'>)</span>
  <span class='ivar'>@logger</span> <span class='op'>=</span> <span class='const'>Logging</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>nose::enumerator</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>

  <span class='ivar'>@workload</span> <span class='op'>=</span> <span class='id identifier rubyid_workload'>workload</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="combine_indexes-instance_method">
  
    #<strong>combine_indexes</strong>(indexes)  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Combine the data of indices based on matching hash fields</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/enumerator.rb', line 87</span>

<span class='kw'>def</span> <span class='id identifier rubyid_combine_indexes'>combine_indexes</span><span class='lparen'>(</span><span class='id identifier rubyid_indexes'>indexes</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_no_order_indexes'>no_order_indexes</span> <span class='op'>=</span> <span class='id identifier rubyid_indexes'>indexes</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_index'>index</span><span class='op'>|</span>
    <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_order_fields'>order_fields</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_no_order_indexes'>no_order_indexes</span> <span class='op'>=</span> <span class='id identifier rubyid_no_order_indexes'>no_order_indexes</span><span class='period'>.</span><span class='id identifier rubyid_group_by'>group_by</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_index'>index</span><span class='op'>|</span>
    <span class='lbracket'>[</span><span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_hash_fields'>hash_fields</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_no_order_indexes'>no_order_indexes</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='lparen'>(</span><span class='id identifier rubyid_hash_fields'>hash_fields</span><span class='comma'>,</span> <span class='id identifier rubyid_graph'>graph</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_hash_indexes'>hash_indexes</span><span class='op'>|</span>
    <span class='id identifier rubyid_extra_choices'>extra_choices</span> <span class='op'>=</span> <span class='id identifier rubyid_hash_indexes'>hash_indexes</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:extra</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span>

    <span class='comment'># XXX More combos?
</span>    <span class='id identifier rubyid_combos'>combos</span> <span class='op'>=</span> <span class='id identifier rubyid_extra_choices'>extra_choices</span><span class='period'>.</span><span class='id identifier rubyid_combination'>combination</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_combos'>combos</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_combo'>combo</span><span class='op'>|</span>
      <span class='id identifier rubyid_indexes'>indexes</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="Index.html" title="NoSE::Index (class)">Index</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Index.html#initialize-instance_method" title="NoSE::Index#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_hash_fields'>hash_fields</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_combo'>combo</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='const'>Set</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='symbol'>:+</span><span class='rparen'>)</span><span class='comma'>,</span>
                           <span class='id identifier rubyid_graph'>graph</span><span class='rparen'>)</span>
      <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Enumerated combined index </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_indexes'>indexes</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="eq_choices-instance_method">
  
    #<strong>eq_choices</strong>(graph, eq)  &#x21d2; <tt><span class='object_link'><a href="../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'><a href="../Array.html" title="Array (class)">Array</a></span>&gt;</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get all possible choices of fields to use for equality</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'><a href="../Array.html" title="Array (class)">Array</a></span>&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


111
112
113
114
115
116
117
118
119
120
121
122
123
124</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/enumerator.rb', line 111</span>

<span class='kw'>def</span> <span class='id identifier rubyid_eq_choices'>eq_choices</span><span class='lparen'>(</span><span class='id identifier rubyid_graph'>graph</span><span class='comma'>,</span> <span class='id identifier rubyid_eq'>eq</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_entity_choices'>entity_choices</span> <span class='op'>=</span> <span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_entities'>entities</span><span class='period'>.</span><span class='id identifier rubyid_flat_map'>flat_map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_entity'>entity</span><span class='op'>|</span>
    <span class='comment'># Get the fields for the entity and add in the IDs
</span>    <span class='id identifier rubyid_entity_fields'>entity_fields</span> <span class='op'>=</span> <span class='id identifier rubyid_eq'>eq</span><span class='lbracket'>[</span><span class='id identifier rubyid_entity'>entity</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_entity'>entity</span><span class='period'>.</span><span class='id identifier rubyid_id_field'>id_field</span>
    <span class='id identifier rubyid_entity_fields'>entity_fields</span><span class='period'>.</span><span class='id identifier rubyid_uniq!'>uniq!</span>
    <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_upto'>upto</span><span class='lparen'>(</span><span class='id identifier rubyid_entity_fields'>entity_fields</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_flat_map'>flat_map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_n'>n</span><span class='op'>|</span>
      <span class='id identifier rubyid_entity_fields'>entity_fields</span><span class='period'>.</span><span class='id identifier rubyid_permutation'>permutation</span><span class='lparen'>(</span><span class='id identifier rubyid_n'>n</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='int'>2</span><span class='period'>.</span><span class='id identifier rubyid_upto'>upto</span><span class='lparen'>(</span><span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_entities'>entities</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_flat_map'>flat_map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_n'>n</span><span class='op'>|</span>
    <span class='id identifier rubyid_entity_choices'>entity_choices</span><span class='period'>.</span><span class='id identifier rubyid_permutation'>permutation</span><span class='lparen'>(</span><span class='id identifier rubyid_n'>n</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:flatten</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
  <span class='kw'>end</span> <span class='op'>+</span> <span class='id identifier rubyid_entity_choices'>entity_choices</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="extra_choices-instance_method">
  
    #<strong>extra_choices</strong>(graph, select, eq, range)  &#x21d2; <tt><span class='object_link'><a href="../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'><a href="../Array.html" title="Array (class)">Array</a></span>&gt;</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get fields which should be included in an index for the given graph</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'><a href="../Array.html" title="Array (class)">Array</a></span>&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


128
129
130
131
132
133
134
135
136</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/enumerator.rb', line 128</span>

<span class='kw'>def</span> <span class='id identifier rubyid_extra_choices'>extra_choices</span><span class='lparen'>(</span><span class='id identifier rubyid_graph'>graph</span><span class='comma'>,</span> <span class='id identifier rubyid_select'>select</span><span class='comma'>,</span> <span class='id identifier rubyid_eq'>eq</span><span class='comma'>,</span> <span class='id identifier rubyid_range'>range</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_choices'>choices</span> <span class='op'>=</span> <span class='id identifier rubyid_eq'>eq</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span> <span class='op'>+</span> <span class='id identifier rubyid_range'>range</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_select'>select</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>

  <span class='id identifier rubyid_choices'>choices</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_choice'>choice</span><span class='op'>|</span>
    <span class='id identifier rubyid_choice'>choice</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_field'>field</span><span class='op'>|</span> <span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_entities'>entities</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_parent'>parent</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_choices'>choices</span><span class='period'>.</span><span class='id identifier rubyid_reject'>reject</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:empty?</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="generate_index-instance_method">
  
    #<strong>generate_index</strong>(hash, order, extra, graph)  &#x21d2; <tt><span class='object_link'><a href="Index.html" title="NoSE::Index (class)">Index</a></span></tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Generate a new index and ignore if invalid</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Index.html" title="NoSE::Index (class)">Index</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


187
188
189
190
191
192
193
194
195
196
197</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/enumerator.rb', line 187</span>

<span class='kw'>def</span> <span class='id identifier rubyid_generate_index'>generate_index</span><span class='lparen'>(</span><span class='id identifier rubyid_hash'>hash</span><span class='comma'>,</span> <span class='id identifier rubyid_order'>order</span><span class='comma'>,</span> <span class='id identifier rubyid_extra'>extra</span><span class='comma'>,</span> <span class='id identifier rubyid_graph'>graph</span><span class='rparen'>)</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Index.html" title="NoSE::Index (class)">Index</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Index.html#initialize-instance_method" title="NoSE::Index#initialize (method)">new</a></span></span> <span class='id identifier rubyid_hash'>hash</span><span class='comma'>,</span> <span class='id identifier rubyid_order'>order</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span><span class='comma'>,</span> <span class='id identifier rubyid_extra'>extra</span><span class='comma'>,</span> <span class='id identifier rubyid_graph'>graph</span>
    <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Enumerated </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
  <span class='kw'>rescue</span> <span class='const'><span class='object_link'><a href="InvalidIndexException.html" title="NoSE::InvalidIndexException (class)">InvalidIndexException</a></span></span>
    <span class='comment'># This combination of fields is not valid, that&#39;s ok
</span>    <span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_index'>index</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="indexes_for_graph-instance_method">
  
    #<strong>indexes_for_graph</strong>(graph, select, eq, range)  &#x21d2; <tt><span class='object_link'><a href="../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'><a href="Index.html" title="NoSE::Index (class)">Index</a></span>&gt;</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get all possible indices which jump a given piece of a query graph</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'><a href="Index.html" title="NoSE::Index (class)">Index</a></span>&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/enumerator.rb', line 140</span>

<span class='kw'>def</span> <span class='id identifier rubyid_indexes_for_graph'>indexes_for_graph</span><span class='lparen'>(</span><span class='id identifier rubyid_graph'>graph</span><span class='comma'>,</span> <span class='id identifier rubyid_select'>select</span><span class='comma'>,</span> <span class='id identifier rubyid_eq'>eq</span><span class='comma'>,</span> <span class='id identifier rubyid_range'>range</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_eq_choices'>eq_choices</span> <span class='op'>=</span> <span class='id identifier rubyid_eq_choices'>eq_choices</span> <span class='id identifier rubyid_graph'>graph</span><span class='comma'>,</span> <span class='id identifier rubyid_eq'>eq</span>
  <span class='id identifier rubyid_range_fields'>range_fields</span> <span class='op'>=</span> <span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_entities'>entities</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_entity'>entity</span><span class='op'>|</span> <span class='id identifier rubyid_range'>range</span><span class='lbracket'>[</span><span class='id identifier rubyid_entity'>entity</span><span class='rbracket'>]</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_reduce'>reduce</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:+</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_range_fields'>range_fields</span><span class='period'>.</span><span class='id identifier rubyid_uniq!'>uniq!</span>
  <span class='id identifier rubyid_order_choices'>order_choices</span> <span class='op'>=</span> <span class='id identifier rubyid_range_fields'>range_fields</span><span class='period'>.</span><span class='id identifier rubyid_prefixes'>prefixes</span><span class='period'>.</span><span class='id identifier rubyid_flat_map'>flat_map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_fields'>fields</span><span class='op'>|</span>
    <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_permutation'>permutation</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
  <span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_extra_choices'>extra_choices</span> <span class='op'>=</span> <span class='id identifier rubyid_extra_choices'>extra_choices</span> <span class='id identifier rubyid_graph'>graph</span><span class='comma'>,</span> <span class='id identifier rubyid_select'>select</span><span class='comma'>,</span> <span class='id identifier rubyid_eq'>eq</span><span class='comma'>,</span> <span class='id identifier rubyid_range'>range</span>
  <span class='id identifier rubyid_extra_choices'>extra_choices</span> <span class='op'>=</span> <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_upto'>upto</span><span class='lparen'>(</span><span class='id identifier rubyid_extra_choices'>extra_choices</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_flat_map'>flat_map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_n'>n</span><span class='op'>|</span>
    <span class='id identifier rubyid_extra_choices'>extra_choices</span><span class='period'>.</span><span class='id identifier rubyid_combination'>combination</span><span class='lparen'>(</span><span class='id identifier rubyid_n'>n</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:flatten</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:uniq</span><span class='rparen'>)</span>
  <span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span>

  <span class='comment'># Generate all possible indices based on the field choices
</span>  <span class='id identifier rubyid_choices'>choices</span> <span class='op'>=</span> <span class='id identifier rubyid_eq_choices'>eq_choices</span><span class='period'>.</span><span class='id identifier rubyid_product'>product</span><span class='lparen'>(</span><span class='id identifier rubyid_extra_choices'>extra_choices</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_indexes'>indexes</span> <span class='op'>=</span> <span class='id identifier rubyid_choices'>choices</span><span class='period'>.</span><span class='id identifier rubyid_map!'>map!</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_extra'>extra</span><span class='op'>|</span>
    <span class='id identifier rubyid_indexes'>indexes</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

    <span class='id identifier rubyid_order_choices'>order_choices</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_order'>order</span><span class='op'>|</span>
      <span class='comment'># Append the primary key of the entities in the graph if needed
</span>      <span class='id identifier rubyid_order'>order</span> <span class='op'>+=</span> <span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_entities'>entities</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:name</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:id_field</span><span class='rparen'>)</span> <span class='op'>-</span>
               <span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span> <span class='op'>+</span> <span class='id identifier rubyid_order'>order</span><span class='rparen'>)</span>

      <span class='comment'># Partition into the ordering portion
</span>      <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_partitions'>partitions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_index_prefix'>index_prefix</span><span class='comma'>,</span> <span class='id identifier rubyid_order_prefix'>order_prefix</span><span class='op'>|</span>
        <span class='id identifier rubyid_hash_fields'>hash_fields</span> <span class='op'>=</span> <span class='id identifier rubyid_index_prefix'>index_prefix</span><span class='period'>.</span><span class='id identifier rubyid_take_while'>take_while</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_field'>field</span><span class='op'>|</span>
          <span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_parent'>parent</span> <span class='op'>==</span> <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_parent'>parent</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_order_fields'>order_fields</span> <span class='op'>=</span> <span class='id identifier rubyid_index_prefix'>index_prefix</span><span class='lbracket'>[</span><span class='id identifier rubyid_hash_fields'>hash_fields</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>+</span> \
                       <span class='id identifier rubyid_order_prefix'>order_prefix</span> <span class='op'>+</span> <span class='id identifier rubyid_order'>order</span>
        <span class='id identifier rubyid_extra_fields'>extra_fields</span> <span class='op'>=</span> <span class='id identifier rubyid_extra'>extra</span> <span class='op'>-</span> <span class='id identifier rubyid_hash_fields'>hash_fields</span> <span class='op'>-</span> <span class='id identifier rubyid_order_fields'>order_fields</span>
        <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_order_fields'>order_fields</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_extra_fields'>extra_fields</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

        <span class='id identifier rubyid_new_index'>new_index</span> <span class='op'>=</span> <span class='id identifier rubyid_generate_index'>generate_index</span> <span class='id identifier rubyid_hash_fields'>hash_fields</span><span class='comma'>,</span> <span class='id identifier rubyid_order_fields'>order_fields</span><span class='comma'>,</span> <span class='id identifier rubyid_extra_fields'>extra_fields</span><span class='comma'>,</span>
                                   <span class='id identifier rubyid_graph'>graph</span>
        <span class='id identifier rubyid_indexes'>indexes</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_new_index'>new_index</span> <span class='kw'>unless</span> <span class='id identifier rubyid_new_index'>new_index</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_indexes'>indexes</span>
  <span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='symbol'>:+</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_indexes'>indexes</span><span class='period'>.</span><span class='id identifier rubyid_flatten!'>flatten!</span>

  <span class='id identifier rubyid_indexes'>indexes</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="indexes_for_query-instance_method">
  
    #<strong>indexes_for_query</strong>(query)  &#x21d2; <tt><span class='object_link'><a href="../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'><a href="Index.html" title="NoSE::Index (class)">Index</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Produce all possible indices for a given query</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'><a href="Index.html" title="NoSE::Index (class)">Index</a></span>&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/enumerator.rb', line 16</span>

<span class='kw'>def</span> <span class='id identifier rubyid_indexes_for_query'>indexes_for_query</span><span class='lparen'>(</span><span class='id identifier rubyid_query'>query</span><span class='rparen'>)</span>
  <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Enumerating indexes for query </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_range'>range</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_range_field'>range_field</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
            <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span>
          <span class='kw'>else</span>
            <span class='lbracket'>[</span><span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_range_field'>range_field</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span>
          <span class='kw'>end</span>

  <span class='id identifier rubyid_eq'>eq</span> <span class='op'>=</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_eq_fields'>eq_fields</span><span class='period'>.</span><span class='id identifier rubyid_group_by'>group_by</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:parent</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_eq'>eq</span><span class='period'>.</span><span class='id identifier rubyid_default_proc'>default_proc</span> <span class='op'>=</span> <span class='tlambda'>-&gt;</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span> <span class='tlambeg'>{</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>

  <span class='id identifier rubyid_range'>range</span> <span class='op'>=</span> <span class='id identifier rubyid_range'>range</span><span class='period'>.</span><span class='id identifier rubyid_group_by'>group_by</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:parent</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_range'>range</span><span class='period'>.</span><span class='id identifier rubyid_default_proc'>default_proc</span> <span class='op'>=</span> <span class='tlambda'>-&gt;</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span> <span class='tlambeg'>{</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>

  <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_subgraphs'>subgraphs</span><span class='period'>.</span><span class='id identifier rubyid_flat_map'>flat_map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_graph'>graph</span><span class='op'>|</span>
    <span class='id identifier rubyid_indexes_for_graph'>indexes_for_graph</span> <span class='id identifier rubyid_graph'>graph</span><span class='comma'>,</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='comma'>,</span> <span class='id identifier rubyid_eq'>eq</span><span class='comma'>,</span> <span class='id identifier rubyid_range'>range</span>
  <span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_materialize_view'>materialize_view</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="indexes_for_workload-instance_method">
  
    #<strong>indexes_for_workload</strong>(additional_indexes = [], by_id_graph = false)  &#x21d2; <tt>Set&lt;<span class='object_link'><a href="Index.html" title="NoSE::Index (class)">Index</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Produce all possible indices for a given workload</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Set&lt;<span class='object_link'><a href="Index.html" title="NoSE::Index (class)">Index</a></span>&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/enumerator.rb', line 38</span>

<span class='kw'>def</span> <span class='id identifier rubyid_indexes_for_workload'>indexes_for_workload</span><span class='lparen'>(</span><span class='id identifier rubyid_additional_indexes'>additional_indexes</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_by_id_graph'>by_id_graph</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_queries'>queries</span> <span class='op'>=</span> <span class='ivar'>@workload</span><span class='period'>.</span><span class='id identifier rubyid_queries'>queries</span>
  <span class='id identifier rubyid_indexes'>indexes</span> <span class='op'>=</span> <span class='const'>Parallel</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='id identifier rubyid_queries'>queries</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_query'>query</span><span class='op'>|</span>
    <span class='id identifier rubyid_indexes_for_query'>indexes_for_query</span><span class='lparen'>(</span><span class='id identifier rubyid_query'>query</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
  <span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='id identifier rubyid_additional_indexes'>additional_indexes</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='symbol'>:+</span><span class='rparen'>)</span>

  <span class='comment'># Add indexes generated for support queries
</span>  <span class='id identifier rubyid_supporting'>supporting</span> <span class='op'>=</span> <span class='id identifier rubyid_support_indexes'>support_indexes</span> <span class='id identifier rubyid_indexes'>indexes</span><span class='comma'>,</span> <span class='id identifier rubyid_by_id_graph'>by_id_graph</span>
  <span class='id identifier rubyid_supporting'>supporting</span> <span class='op'>+=</span> <span class='id identifier rubyid_support_indexes'>support_indexes</span> <span class='id identifier rubyid_supporting'>supporting</span><span class='comma'>,</span> <span class='id identifier rubyid_by_id_graph'>by_id_graph</span>
  <span class='id identifier rubyid_indexes'>indexes</span> <span class='op'>+=</span> <span class='id identifier rubyid_supporting'>supporting</span>

  <span class='comment'># Deduplicate indexes, combine them and deduplicate again
</span>  <span class='id identifier rubyid_indexes'>indexes</span><span class='period'>.</span><span class='id identifier rubyid_uniq!'>uniq!</span>
  <span class='id identifier rubyid_combine_indexes'>combine_indexes</span> <span class='id identifier rubyid_indexes'>indexes</span>
  <span class='id identifier rubyid_indexes'>indexes</span><span class='period'>.</span><span class='id identifier rubyid_uniq!'>uniq!</span>

  <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='kw'>do</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Indexes for workload:\n</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_indexes'>indexes</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='period'>.</span><span class='id identifier rubyid_with_index'>with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_i'>i</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_indexes'>indexes</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="support_indexes-instance_method">
  
    #<strong>support_indexes</strong>(indexes, by_id_graph)  &#x21d2; <tt><span class='object_link'><a href="../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'><a href="Index.html" title="NoSE::Index (class)">Index</a></span>&gt;</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Produce the indexes necessary for support queries for these indexes</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'><a href="Index.html" title="NoSE::Index (class)">Index</a></span>&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/enumerator.rb', line 67</span>

<span class='kw'>def</span> <span class='id identifier rubyid_support_indexes'>support_indexes</span><span class='lparen'>(</span><span class='id identifier rubyid_indexes'>indexes</span><span class='comma'>,</span> <span class='id identifier rubyid_by_id_graph'>by_id_graph</span><span class='rparen'>)</span>
  <span class='comment'># If indexes are grouped by ID graph, convert them before updating
</span>  <span class='comment'># since other updates will be managed automatically by index maintenance
</span>  <span class='id identifier rubyid_indexes'>indexes</span> <span class='op'>=</span> <span class='id identifier rubyid_indexes'>indexes</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_id_graph</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span> <span class='kw'>if</span> <span class='id identifier rubyid_by_id_graph'>by_id_graph</span>

  <span class='comment'># Collect all possible support queries
</span>  <span class='id identifier rubyid_queries'>queries</span> <span class='op'>=</span> <span class='id identifier rubyid_indexes'>indexes</span><span class='period'>.</span><span class='id identifier rubyid_flat_map'>flat_map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_index'>index</span><span class='op'>|</span>
    <span class='ivar'>@workload</span><span class='period'>.</span><span class='id identifier rubyid_updates'>updates</span><span class='period'>.</span><span class='id identifier rubyid_flat_map'>flat_map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_update'>update</span><span class='op'>|</span>
      <span class='id identifier rubyid_update'>update</span><span class='period'>.</span><span class='id identifier rubyid_support_queries'>support_queries</span><span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Enumerate indexes for each support query
</span>  <span class='id identifier rubyid_queries'>queries</span><span class='period'>.</span><span class='id identifier rubyid_uniq!'>uniq!</span>
  <span class='id identifier rubyid_queries'>queries</span><span class='period'>.</span><span class='id identifier rubyid_flat_map'>flat_map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_query'>query</span><span class='op'>|</span>
    <span class='id identifier rubyid_indexes_for_query'>indexes_for_query</span><span class='lparen'>(</span><span class='id identifier rubyid_query'>query</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Jul 28 18:48:06 2020 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.25 (ruby-2.7.1).
</div>

    </div>
  </body>
</html>