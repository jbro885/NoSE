<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: NoSE::Backend::PreparedUpdate
  
    &mdash; Documentation by YARD 0.9.24
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "NoSE::Backend::PreparedUpdate";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (P)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../NoSE.html" title="NoSE (module)">NoSE</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Backend.html" title="NoSE::Backend (module)">Backend</a></span></span>
     &raquo; 
    <span class="title">PreparedUpdate</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: NoSE::Backend::PreparedUpdate
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">NoSE::Backend::PreparedUpdate</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/nose/backend.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>An update prepared with a backend which is ready to execute</p>


  </div>
</div>
<div class="tags">
  

</div>



  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#statement-instance_method" title="#statement (instance method)">#<strong>statement</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute statement.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#steps-instance_method" title="#steps (instance method)">#<strong>steps</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute steps.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#execute-instance_method" title="#execute (instance method)">#<strong>execute</strong>(update_settings, update_conditions)  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Execute the statement for the given set of conditions.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#initial_update_settings-instance_method" title="#initial_update_settings (instance method)">#<strong>initial_update_settings</strong>(update_settings, update_conditions)  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get the initial values which will be used in the first plan step.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(statement, support_plans, steps)  &#x21d2; PreparedUpdate </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of PreparedUpdate.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#support_results-instance_method" title="#support_results (instance method)">#<strong>support_results</strong>(settings)  &#x21d2; Array&lt;Hash&gt; </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Execute all the support queries.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(statement, support_plans, steps)  &#x21d2; <tt><span class='object_link'><a href="" title="NoSE::Backend::PreparedUpdate (class)">PreparedUpdate</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a new instance of PreparedUpdate.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


402
403
404
405
406
407
408
409
410
411</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/backend.rb', line 402</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_statement'>statement</span><span class='comma'>,</span> <span class='id identifier rubyid_support_plans'>support_plans</span><span class='comma'>,</span> <span class='id identifier rubyid_steps'>steps</span><span class='rparen'>)</span>
  <span class='ivar'>@statement</span> <span class='op'>=</span> <span class='id identifier rubyid_statement'>statement</span>
  <span class='ivar'>@support_plans</span> <span class='op'>=</span> <span class='id identifier rubyid_support_plans'>support_plans</span>
  <span class='ivar'>@delete_step</span> <span class='op'>=</span> <span class='id identifier rubyid_steps'>steps</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_step'>step</span><span class='op'>|</span>
    <span class='id identifier rubyid_step'>step</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'><span class='object_link'><a href="Backend.html" title="NoSE::Backend::Backend (class)">Backend</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Backend/DeleteStatementStep.html" title="NoSE::Backend::Backend::DeleteStatementStep (class)">DeleteStatementStep</a></span></span>
  <span class='kw'>end</span>
  <span class='ivar'>@insert_step</span> <span class='op'>=</span> <span class='id identifier rubyid_steps'>steps</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_step'>step</span><span class='op'>|</span>
    <span class='id identifier rubyid_step'>step</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'><span class='object_link'><a href="Backend.html" title="NoSE::Backend::Backend (class)">Backend</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Backend/InsertStatementStep.html" title="NoSE::Backend::Backend::InsertStatementStep (class)">InsertStatementStep</a></span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="statement-instance_method">
  
    #<strong>statement</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute statement.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


400
401
402</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/backend.rb', line 400</span>

<span class='kw'>def</span> <span class='id identifier rubyid_statement'>statement</span>
  <span class='ivar'>@statement</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="steps-instance_method">
  
    #<strong>steps</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute steps.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


400
401
402</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/backend.rb', line 400</span>

<span class='kw'>def</span> <span class='id identifier rubyid_steps'>steps</span>
  <span class='ivar'>@steps</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="execute-instance_method">
  
    #<strong>execute</strong>(update_settings, update_conditions)  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Execute the statement for the given set of conditions</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/backend.rb', line 415</span>

<span class='kw'>def</span> <span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_update_settings'>update_settings</span><span class='comma'>,</span> <span class='id identifier rubyid_update_conditions'>update_conditions</span><span class='rparen'>)</span>
  <span class='comment'># Execute all the support queries
</span>  <span class='id identifier rubyid_settings'>settings</span> <span class='op'>=</span> <span class='id identifier rubyid_initial_update_settings'>initial_update_settings</span> <span class='id identifier rubyid_update_settings'>update_settings</span><span class='comma'>,</span> <span class='id identifier rubyid_update_conditions'>update_conditions</span>

  <span class='comment'># Execute the support queries for this update
</span>  <span class='id identifier rubyid_support'>support</span> <span class='op'>=</span> <span class='id identifier rubyid_support_results'>support_results</span> <span class='id identifier rubyid_update_conditions'>update_conditions</span>

  <span class='comment'># Perform the deletion
</span>  <span class='ivar'>@delete_step</span><span class='period'>.</span><span class='id identifier rubyid_process'>process</span> <span class='id identifier rubyid_support'>support</span> <span class='kw'>unless</span> <span class='id identifier rubyid_support'>support</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>||</span> <span class='ivar'>@delete_step</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='ivar'>@insert_step</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='comment'># Get the fields which should be used from the original statement
</span>  <span class='comment'># If we didn&#39;t delete old entries, then we just need the primary key
</span>  <span class='comment'># attributes of the index, otherwise we need everything
</span>  <span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> <span class='ivar'>@insert_step</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span>
  <span class='id identifier rubyid_include_fields'>include_fields</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='ivar'>@delete_step</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                     <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_hash_fields'>hash_fields</span> <span class='op'>+</span> <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_order_fields'>order_fields</span>
                   <span class='kw'>else</span>
                     <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_all_fields'>all_fields</span>
                   <span class='kw'>end</span>

  <span class='comment'># Add fields from the original statement
</span>  <span class='id identifier rubyid_update_conditions'>update_conditions</span><span class='period'>.</span><span class='id identifier rubyid_each_value'>each_value</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_condition'>condition</span><span class='op'>|</span>
    <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_include_fields'>include_fields</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_condition'>condition</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span>
    <span class='id identifier rubyid_settings'>settings</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span> <span class='id identifier rubyid_condition'>condition</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_condition'>condition</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_support'>support</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_support'>support</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_settings'>settings</span><span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_support'>support</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
      <span class='id identifier rubyid_row'>row</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span><span class='lparen'>(</span><span class='id identifier rubyid_settings'>settings</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='op'>|</span> <span class='id identifier rubyid_value'>value</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Stop if we have nothing to insert, otherwise insert
</span>  <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_support'>support</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='ivar'>@insert_step</span><span class='period'>.</span><span class='id identifier rubyid_process'>process</span> <span class='id identifier rubyid_support'>support</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="initial_update_settings-instance_method">
  
    #<strong>initial_update_settings</strong>(update_settings, update_conditions)  &#x21d2; <tt>Hash</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get the initial values which will be used in the first plan step</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


459
460
461
462
463
464
465
466
467
468
469
470
471
472
473</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/backend.rb', line 459</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initial_update_settings'>initial_update_settings</span><span class='lparen'>(</span><span class='id identifier rubyid_update_settings'>update_settings</span><span class='comma'>,</span> <span class='id identifier rubyid_update_conditions'>update_conditions</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@insert_step</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@delete_step</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>    <span class='comment'># Populate the data to insert for Insert statements
</span>
    <span class='id identifier rubyid_settings'>settings</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_update_settings'>update_settings</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_setting'>setting</span><span class='op'>|</span>
      <span class='lbracket'>[</span><span class='id identifier rubyid_setting'>setting</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_setting'>setting</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='rbracket'>]</span>
    <span class='kw'>end</span><span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='comment'># Get values for updates and deletes
</span>    <span class='id identifier rubyid_settings'>settings</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_update_conditions'>update_conditions</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_field_id'>field_id</span><span class='comma'>,</span> <span class='id identifier rubyid_condition'>condition</span><span class='op'>|</span>
      <span class='lbracket'>[</span><span class='id identifier rubyid_field_id'>field_id</span><span class='comma'>,</span> <span class='id identifier rubyid_condition'>condition</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='rbracket'>]</span>
    <span class='kw'>end</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_settings'>settings</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="support_results-instance_method">
  
    #<strong>support_results</strong>(settings)  &#x21d2; <tt><span class='object_link'><a href="../../Array.html" title="Array (class)">Array</a></span>&lt;Hash&gt;</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Execute all the support queries</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Array.html" title="Array (class)">Array</a></span>&lt;Hash&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/backend.rb', line 477</span>

<span class='kw'>def</span> <span class='id identifier rubyid_support_results'>support_results</span><span class='lparen'>(</span><span class='id identifier rubyid_settings'>settings</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='ivar'>@support_plans</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

  <span class='comment'># Get a hash of values used in settings, first
</span>  <span class='comment'># resolving any settings which specify foreign keys
</span>  <span class='id identifier rubyid_settings'>settings</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_settings'>settings</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    <span class='id identifier rubyid_new_condition'>new_condition</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_resolve_foreign_key'>resolve_foreign_key</span>
    <span class='lbracket'>[</span><span class='id identifier rubyid_new_condition'>new_condition</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_new_condition'>new_condition</span><span class='rbracket'>]</span>
  <span class='kw'>end</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_setting_values'>setting_values</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_settings'>settings</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='rbracket'>]</span> <span class='rbrace'>}</span><span class='rbracket'>]</span>

  <span class='comment'># If we have no query for IDs on the first entity, we must
</span>  <span class='comment'># have the fields we need to execute the other support queries
</span>  <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@statement</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>&amp;&amp;</span>
     <span class='ivar'>@support_plans</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_entity'>entity</span> <span class='op'>!=</span> <span class='ivar'>@statement</span><span class='period'>.</span><span class='id identifier rubyid_entity'>entity</span>
    <span class='id identifier rubyid_support'>support</span> <span class='op'>=</span> <span class='ivar'>@support_plans</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_plan'>plan</span><span class='op'>|</span>
      <span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span> <span class='id identifier rubyid_settings'>settings</span>
    <span class='kw'>end</span>

    <span class='comment'># Combine the results from multiple support queries
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_support'>support</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_support'>support</span> <span class='op'>=</span> <span class='id identifier rubyid_support'>support</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_product'>product</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_support'>support</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_support'>support</span><span class='period'>.</span><span class='id identifier rubyid_map!'>map!</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_results'>results</span><span class='op'>|</span>
        <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_reduce'>reduce</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:merge!</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span><span class='lparen'>(</span><span class='id identifier rubyid_setting_values'>setting_values</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='comment'># Execute the first support query to get a list of IDs
</span>    <span class='id identifier rubyid_first_query'>first_query</span> <span class='op'>=</span> <span class='ivar'>@support_plans</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span>

    <span class='comment'># We may not have a statement if this is manually defined
</span>    <span class='kw'>if</span> <span class='ivar'>@statement</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_select_key'>select_key</span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='id identifier rubyid_entity_fields'>entity_fields</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_id'>id</span> <span class='op'>=</span> <span class='ivar'>@statement</span><span class='period'>.</span><span class='id identifier rubyid_entity'>entity</span><span class='period'>.</span><span class='id identifier rubyid_id_field'>id_field</span>
      <span class='id identifier rubyid_select_key'>select_key</span> <span class='op'>=</span> <span class='id identifier rubyid_first_query'>first_query</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_id'>id</span>

      <span class='comment'># Select any fields from the entity being modified if required
</span>      <span class='id identifier rubyid_entity_fields'>entity_fields</span> <span class='op'>=</span> <span class='ivar'>@support_plans</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span> <span class='id identifier rubyid_settings'>settings</span> \
        <span class='kw'>if</span> <span class='id identifier rubyid_first_query'>first_query</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>1</span> <span class='op'>&amp;&amp;</span> \
           <span class='id identifier rubyid_first_query'>first_query</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_entities'>entities</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> <span class='op'>==</span> <span class='ivar'>@statement</span><span class='period'>.</span><span class='id identifier rubyid_entity'>entity</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_select_key'>select_key</span>      <span class='comment'># Pull the IDs from the first support query
</span>
      <span class='id identifier rubyid_conditions'>conditions</span> <span class='op'>=</span> <span class='id identifier rubyid_entity_fields'>entity_fields</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
        <span class='lbrace'>{</span> <span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span> <span class='op'>=&gt;</span> <span class='const'><span class='object_link'><a href="../Condition.html" title="NoSE::Condition (class)">Condition</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Condition.html#initialize-instance_method" title="NoSE::Condition#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:&#39;=&#39;</span><span class='comma'>,</span> <span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='comment'># Use the ID specified in the statement conditions
</span>      <span class='id identifier rubyid_conditions'>conditions</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_settings'>settings</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>

    <span class='comment'># Execute the support queries for each ID
</span>    <span class='id identifier rubyid_support'>support</span> <span class='op'>=</span> <span class='id identifier rubyid_conditions'>conditions</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span><span class='period'>.</span><span class='id identifier rubyid_flat_map'>flat_map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_condition'>condition</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
      <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='ivar'>@support_plans</span><span class='lbracket'>[</span><span class='lparen'>(</span><span class='id identifier rubyid_select_key'>select_key</span> <span class='op'>?</span> <span class='int'>1</span> <span class='op'>:</span> <span class='int'>0</span><span class='rparen'>)</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_plan'>plan</span><span class='op'>|</span>
        <span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span> <span class='id identifier rubyid_condition'>condition</span>
      <span class='kw'>end</span>

      <span class='comment'># Combine the results of the different support queries
</span>      <span class='id identifier rubyid_results'>results</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_product'>product</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_results'>results</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_result'>result</span><span class='op'>|</span>
        <span class='id identifier rubyid_row'>row</span> <span class='op'>=</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_reduce'>reduce</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:merge!</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_row'>row</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span><span class='lparen'>(</span><span class='id identifier rubyid_entity_fields'>entity_fields</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_entity_fields'>entity_fields</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_row'>row</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span><span class='lparen'>(</span><span class='id identifier rubyid_setting_values'>setting_values</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_row'>row</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_support'>support</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Fri Feb 28 13:56:15 2020 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.24 (ruby-2.7.0).
</div>

    </div>
  </body>
</html>