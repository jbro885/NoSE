<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: NoSE::Plans::IndexLookupPlanStep
  
    &mdash; Documentation by YARD 0.9.25
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "NoSE::Plans::IndexLookupPlanStep";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (I)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../NoSE.html" title="NoSE (module)">NoSE</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Plans.html" title="NoSE::Plans (module)">Plans</a></span></span>
     &raquo; 
    <span class="title">IndexLookupPlanStep</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: NoSE::Plans::IndexLookupPlanStep
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="PlanStep.html" title="NoSE::Plans::PlanStep (class)">PlanStep</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next"><span class='object_link'><a href="PlanStep.html" title="NoSE::Plans::PlanStep (class)">PlanStep</a></span></li>
          
            <li class="next">NoSE::Plans::IndexLookupPlanStep</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  <dl>
      <dt>Extended by:</dt>
      <dd>Forwardable</dd>
  </dl>
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/nose/plans/index_lookup.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Superclass for steps using indices</p>


  </div>
</div>
<div class="tags">
  

</div>



  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#eq_filter-instance_method" title="#eq_filter (instance method)">#<strong>eq_filter</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute eq_filter.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#index-instance_method" title="#index (instance method)">#<strong>index</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute index.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#limit-instance_method" title="#limit (instance method)">#<strong>limit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute limit.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#order_by-instance_method" title="#order_by (instance method)">#<strong>order_by</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute order_by.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#range_filter-instance_method" title="#range_filter (instance method)">#<strong>range_filter</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute range_filter.</p>
</div></span>
  
</li>

    
  </ul>



  
  
  <h3 class="inherited">Attributes inherited from <span class='object_link'><a href="PlanStep.html" title="NoSE::Plans::PlanStep (class)">PlanStep</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="PlanStep.html#children-instance_method" title="NoSE::Plans::PlanStep#children (method)">#children</a></span>, <span class='object_link'><a href="PlanStep.html#cost-instance_method" title="NoSE::Plans::PlanStep#cost (method)">#cost</a></span>, <span class='object_link'><a href="PlanStep.html#fields-instance_method" title="NoSE::Plans::PlanStep#fields (method)">#fields</a></span>, <span class='object_link'><a href="PlanStep.html#parent-instance_method" title="NoSE::Plans::PlanStep#parent (method)">#parent</a></span>, <span class='object_link'><a href="PlanStep.html#state-instance_method" title="NoSE::Plans::PlanStep#state (method)">#state</a></span></p>


  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#apply-class_method" title="apply (class method)">.<strong>apply</strong>(parent, index, state)  &#x21d2; IndexLookupPlanStep </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Check if this step can be applied for the given index, returning a possible application of the step.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#check_all_hash_fields-class_method" title="check_all_hash_fields (class method)">.<strong>check_all_hash_fields</strong>(parent, index, state)  &#x21d2; void </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Check that we have all hash fields needed to perform the lookup.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#check_forward_lookup-class_method" title="check_forward_lookup (class method)">.<strong>check_forward_lookup</strong>(parent, index, state)  &#x21d2; void </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Check that this index moves forward on the list of joins.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#check_graph_fields-class_method" title="check_graph_fields (class method)">.<strong>check_graph_fields</strong>(parent, index, state)  &#x21d2; void </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get fields in the query relevant to this index and check that they are provided for us here.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#check_joins-class_method" title="check_joins (class method)">.<strong>check_joins</strong>(index, state)  &#x21d2; void </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Check that this index is a valid continuation of the set of joins.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#check_last_fields-class_method" title="check_last_fields (class method)">.<strong>check_last_fields</strong>(index, state)  &#x21d2; void </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#check_parent_index-class_method" title="check_parent_index (class method)">.<strong>check_parent_index</strong>(parent, index, state)  &#x21d2; void </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Check that this index is a valid continuation of the set of joins.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#invalid_parent_index%3F-class_method" title="invalid_parent_index? (class method)">.<strong>invalid_parent_index?</strong>(state, index, parent_index)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Check if this index can be used after the current parent.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#last_fields%3F-class_method" title="last_fields? (class method)">.<strong>last_fields?</strong>(index, state)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Check that we have the required fields to move on with the next lookup.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#==-instance_method" title="#== (instance method)">#<strong>==</strong>(other)  &#x21d2; Object </a>
    

    
      (also: #eql?)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Two index steps are equal if they use the same index.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(index, state = nil, parent = nil)  &#x21d2; IndexLookupPlanStep </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of IndexLookupPlanStep.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#range_order_prefix-instance_method" title="#range_order_prefix (instance method)">#<strong>range_order_prefix</strong>  &#x21d2; Array&lt;Fields::Field&gt; </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get the set of fields which can be filtered by the ordered keys.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#resolve_order-instance_method" title="#resolve_order (instance method)">#<strong>resolve_order</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Perform any ordering implicit to this index.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#strip_graph-instance_method" title="#strip_graph (instance method)">#<strong>strip_graph</strong>  &#x21d2; void </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Strip the graph for this index, but if we haven&#39;t fetched all fields, leave the last one so we can perform a separate ID lookup.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_color-instance_method" title="#to_color (instance method)">#<strong>to_color</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>:nocov:.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#update_cardinality-instance_method" title="#update_cardinality (instance method)">#<strong>update_cardinality</strong>(parent, indexed_by_id)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Update the cardinality of this step, applying a limit if possible.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#update_state-instance_method" title="#update_state (instance method)">#<strong>update_state</strong>(parent)  &#x21d2; void </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Modify the state to reflect the fields looked up by the index.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="PlanStep.html" title="NoSE::Plans::PlanStep (class)">PlanStep</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="PlanStep.html#add_fields_from_index-instance_method" title="NoSE::Plans::PlanStep#add_fields_from_index (method)">#add_fields_from_index</a></span>, <span class='object_link'><a href="PlanStep.html#calculate_cost-instance_method" title="NoSE::Plans::PlanStep#calculate_cost (method)">#calculate_cost</a></span>, <span class='object_link'><a href="PlanStep.html#inherited-class_method" title="NoSE::Plans::PlanStep.inherited (method)">inherited</a></span>, <span class='object_link'><a href="PlanStep.html#parent_index-instance_method" title="NoSE::Plans::PlanStep#parent_index (method)">#parent_index</a></span>, <span class='object_link'><a href="PlanStep.html#parent_steps-instance_method" title="NoSE::Plans::PlanStep#parent_steps (method)">#parent_steps</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../../Supertype.html" title="Supertype (module)">Supertype</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../Supertype.html#included-class_method" title="Supertype.included (method)">included</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(index, state = nil, parent = nil)  &#x21d2; <tt><span class='object_link'><a href="" title="NoSE::Plans::IndexLookupPlanStep (class)">IndexLookupPlanStep</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a new instance of IndexLookupPlanStep.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/plans/index_lookup.rb', line 12</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_parent'>parent</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>super</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='ivar'>@index</span> <span class='op'>=</span> <span class='id identifier rubyid_index'>index</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span>
    <span class='id identifier rubyid_all_fields'>all_fields</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_all_fields'>all_fields</span>
    <span class='ivar'>@fields</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='ivar'>@index</span><span class='period'>.</span><span class='id identifier rubyid_hash_fields'>hash_fields</span> <span class='op'>+</span> <span class='ivar'>@index</span><span class='period'>.</span><span class='id identifier rubyid_order_fields'>order_fields</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_set'>to_set</span> <span class='op'>+</span> \
              <span class='lparen'>(</span><span class='ivar'>@index</span><span class='period'>.</span><span class='id identifier rubyid_extra'>extra</span><span class='period'>.</span><span class='id identifier rubyid_to_set'>to_set</span> <span class='op'>&amp;</span> <span class='id identifier rubyid_all_fields'>all_fields</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='ivar'>@fields</span> <span class='op'>=</span> <span class='ivar'>@index</span><span class='period'>.</span><span class='id identifier rubyid_all_fields'>all_fields</span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='ivar'>@state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_update_state'>update_state</span> <span class='id identifier rubyid_parent'>parent</span>
  <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="eq_filter-instance_method">
  
    #<strong>eq_filter</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute eq_filter.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


9
10
11</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/plans/index_lookup.rb', line 9</span>

<span class='kw'>def</span> <span class='id identifier rubyid_eq_filter'>eq_filter</span>
  <span class='ivar'>@eq_filter</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="index-instance_method">
  
    #<strong>index</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute index.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


9
10
11</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/plans/index_lookup.rb', line 9</span>

<span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
  <span class='ivar'>@index</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="limit-instance_method">
  
    #<strong>limit</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute limit.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


9
10
11</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/plans/index_lookup.rb', line 9</span>

<span class='kw'>def</span> <span class='id identifier rubyid_limit'>limit</span>
  <span class='ivar'>@limit</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="order_by-instance_method">
  
    #<strong>order_by</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute order_by.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


9
10
11</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/plans/index_lookup.rb', line 9</span>

<span class='kw'>def</span> <span class='id identifier rubyid_order_by'>order_by</span>
  <span class='ivar'>@order_by</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="range_filter-instance_method">
  
    #<strong>range_filter</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute range_filter.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


9
10
11</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/plans/index_lookup.rb', line 9</span>

<span class='kw'>def</span> <span class='id identifier rubyid_range_filter'>range_filter</span>
  <span class='ivar'>@range_filter</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="apply-class_method">
  
    .<strong>apply</strong>(parent, index, state)  &#x21d2; <tt><span class='object_link'><a href="" title="NoSE::Plans::IndexLookupPlanStep (class)">IndexLookupPlanStep</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Check if this step can be applied for the given index, returning a possible application of the step</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="NoSE::Plans::IndexLookupPlanStep (class)">IndexLookupPlanStep</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


50
51
52
53
54
55
56
57
58
59
60
61
62
63
64</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/plans/index_lookup.rb', line 50</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_apply'>apply</span><span class='lparen'>(</span><span class='id identifier rubyid_parent'>parent</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
  <span class='comment'># Validate several conditions which identify if this index is usable
</span>  <span class='kw'>begin</span>
    <span class='id identifier rubyid_check_joins'>check_joins</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_state'>state</span>
    <span class='id identifier rubyid_check_forward_lookup'>check_forward_lookup</span> <span class='id identifier rubyid_parent'>parent</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_state'>state</span>
    <span class='id identifier rubyid_check_parent_index'>check_parent_index</span> <span class='id identifier rubyid_parent'>parent</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_state'>state</span>
    <span class='id identifier rubyid_check_all_hash_fields'>check_all_hash_fields</span> <span class='id identifier rubyid_parent'>parent</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_state'>state</span>
    <span class='id identifier rubyid_check_graph_fields'>check_graph_fields</span> <span class='id identifier rubyid_parent'>parent</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_state'>state</span>
    <span class='id identifier rubyid_check_last_fields'>check_last_fields</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_state'>state</span>
  <span class='kw'>rescue</span> <span class='const'><span class='object_link'><a href="InvalidIndex.html" title="NoSE::Plans::InvalidIndex (class)">InvalidIndex</a></span></span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='const'><span class='object_link'><a href="" title="NoSE::Plans::IndexLookupPlanStep (class)">IndexLookupPlanStep</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="NoSE::Plans::IndexLookupPlanStep#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_parent'>parent</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="check_all_hash_fields-class_method">
  
    .<strong>check_all_hash_fields</strong>(parent, index, state)  &#x21d2; <tt>void</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Check that we have all hash fields needed to perform the lookup</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="InvalidIndex.html" title="NoSE::Plans::InvalidIndex (class)">InvalidIndex</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


127
128
129
130
131</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/plans/index_lookup.rb', line 127</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_check_all_hash_fields'>check_all_hash_fields</span><span class='lparen'>(</span><span class='id identifier rubyid_parent'>parent</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_fail'>fail</span> <span class='const'><span class='object_link'><a href="InvalidIndex.html" title="NoSE::Plans::InvalidIndex (class)">InvalidIndex</a></span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_hash_fields'>hash_fields</span><span class='period'>.</span><span class='id identifier rubyid_all?'>all?</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_field'>field</span><span class='op'>|</span>
    <span class='lparen'>(</span><span class='id identifier rubyid_parent'>parent</span><span class='period'>.</span><span class='id identifier rubyid_fields'>fields</span> <span class='op'>+</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_given_fields'>given_fields</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_field'>field</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="check_forward_lookup-class_method">
  
    .<strong>check_forward_lookup</strong>(parent, index, state)  &#x21d2; <tt>void</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Check that this index moves forward on the list of joins</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="InvalidIndex.html" title="NoSE::Plans::InvalidIndex (class)">InvalidIndex</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


81
82
83
84
85
86
87</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/plans/index_lookup.rb', line 81</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_check_forward_lookup'>check_forward_lookup</span><span class='lparen'>(</span><span class='id identifier rubyid_parent'>parent</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
  <span class='comment'># XXX This disallows plans which look up additional attributes
</span>  <span class='comment'>#     for entities other than the final one
</span>  <span class='id identifier rubyid_fail'>fail</span> <span class='const'><span class='object_link'><a href="InvalidIndex.html" title="NoSE::Plans::InvalidIndex (class)">InvalidIndex</a></span></span> <span class='kw'>if</span> <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>1</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>1</span> <span class='op'>&amp;&amp;</span>
                       <span class='op'>!</span><span class='id identifier rubyid_parent'>parent</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="RootPlanStep.html" title="NoSE::Plans::RootPlanStep (class)">RootPlanStep</a></span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_fail'>fail</span> <span class='const'><span class='object_link'><a href="InvalidIndex.html" title="NoSE::Plans::InvalidIndex (class)">InvalidIndex</a></span></span> <span class='kw'>if</span> <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_identity?'>identity?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>1</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="check_graph_fields-class_method">
  
    .<strong>check_graph_fields</strong>(parent, index, state)  &#x21d2; <tt>void</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Get fields in the query relevant to this index and check that they are provided for us here</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="InvalidIndex.html" title="NoSE::Plans::InvalidIndex (class)">InvalidIndex</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


138
139
140
141
142
143</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/plans/index_lookup.rb', line 138</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_check_graph_fields'>check_graph_fields</span><span class='lparen'>(</span><span class='id identifier rubyid_parent'>parent</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_hash_entity'>hash_entity</span> <span class='op'>=</span> <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_hash_fields'>hash_fields</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_parent'>parent</span>
  <span class='id identifier rubyid_graph_fields'>graph_fields</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_fields_for_graph'>fields_for_graph</span><span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='comma'>,</span> <span class='id identifier rubyid_hash_entity'>hash_entity</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_set'>to_set</span>
  <span class='id identifier rubyid_graph_fields'>graph_fields</span> <span class='op'>-=</span> <span class='id identifier rubyid_parent'>parent</span><span class='period'>.</span><span class='id identifier rubyid_fields'>fields</span> <span class='comment'># exclude fields already fetched
</span>  <span class='id identifier rubyid_fail'>fail</span> <span class='const'><span class='object_link'><a href="InvalidIndex.html" title="NoSE::Plans::InvalidIndex (class)">InvalidIndex</a></span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_graph_fields'>graph_fields</span><span class='period'>.</span><span class='id identifier rubyid_subset?'>subset?</span><span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_all_fields'>all_fields</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="check_joins-class_method">
  
    .<strong>check_joins</strong>(index, state)  &#x21d2; <tt>void</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Check that this index is a valid continuation of the set of joins</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="InvalidIndex.html" title="NoSE::Plans::InvalidIndex (class)">InvalidIndex</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


69
70
71
72
73
74
75</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/plans/index_lookup.rb', line 69</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_check_joins'>check_joins</span><span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_fail'>fail</span> <span class='const'><span class='object_link'><a href="InvalidIndex.html" title="NoSE::Plans::InvalidIndex (class)">InvalidIndex</a></span></span> \
    <span class='kw'>unless</span> <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_entities'>entities</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_joins'>joins</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span>
           <span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_unique_edges'>unique_edges</span> <span class='op'>&amp;</span>
            <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_unique_edges'>unique_edges</span> <span class='op'>==</span>
            <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_unique_edges'>unique_edges</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="check_last_fields-class_method">
  
    .<strong>check_last_fields</strong>(index, state)  &#x21d2; <tt>void</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="InvalidIndex.html" title="NoSE::Plans::InvalidIndex (class)">InvalidIndex</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


167
168
169</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/plans/index_lookup.rb', line 167</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_check_last_fields'>check_last_fields</span><span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_fail'>fail</span> <span class='const'><span class='object_link'><a href="InvalidIndex.html" title="NoSE::Plans::InvalidIndex (class)">InvalidIndex</a></span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_last_fields?'>last_fields?</span><span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="check_parent_index-class_method">
  
    .<strong>check_parent_index</strong>(parent, index, state)  &#x21d2; <tt>void</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Check that this index is a valid continuation of the set of joins</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="InvalidIndex.html" title="NoSE::Plans::InvalidIndex (class)">InvalidIndex</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


118
119
120
121</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/plans/index_lookup.rb', line 118</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_check_parent_index'>check_parent_index</span><span class='lparen'>(</span><span class='id identifier rubyid_parent'>parent</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_fail'>fail</span> <span class='const'><span class='object_link'><a href="InvalidIndex.html" title="NoSE::Plans::InvalidIndex (class)">InvalidIndex</a></span></span> \
    <span class='kw'>if</span> <span class='id identifier rubyid_invalid_parent_index?'>invalid_parent_index?</span> <span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_parent'>parent</span><span class='period'>.</span><span class='id identifier rubyid_parent_index'>parent_index</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="invalid_parent_index?-class_method">
  
    .<strong>invalid_parent_index?</strong>(state, index, parent_index)  &#x21d2; <tt>Boolean</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Check if this index can be used after the current parent</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/plans/index_lookup.rb', line 92</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_invalid_parent_index?'>invalid_parent_index?</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_parent_index'>parent_index</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_parent_index'>parent_index</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='comment'># We don&#39;t do multiple lookups by ID for the same entity set
</span>  <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_parent_index'>parent_index</span><span class='period'>.</span><span class='id identifier rubyid_identity?'>identity?</span> <span class='op'>&amp;&amp;</span>
                 <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span> <span class='op'>==</span> <span class='id identifier rubyid_parent_index'>parent_index</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span>

  <span class='comment'># If the last step gave an ID, we must use it
</span>  <span class='comment'># XXX This doesn&#39;t cover all cases
</span>  <span class='id identifier rubyid_last_parent_entity'>last_parent_entity</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_joins'>joins</span><span class='period'>.</span><span class='id identifier rubyid_reverse'>reverse</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_entity'>entity</span><span class='op'>|</span>
    <span class='id identifier rubyid_parent_index'>parent_index</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_entities'>entities</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_entity'>entity</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_parent_ids'>parent_ids</span> <span class='op'>=</span> <span class='const'>Set</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbracket'>[</span><span class='id identifier rubyid_last_parent_entity'>last_parent_entity</span><span class='period'>.</span><span class='id identifier rubyid_id_field'>id_field</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_has_ids'>has_ids</span> <span class='op'>=</span> <span class='id identifier rubyid_parent_ids'>parent_ids</span><span class='period'>.</span><span class='id identifier rubyid_subset?'>subset?</span> <span class='id identifier rubyid_parent_index'>parent_index</span><span class='period'>.</span><span class='id identifier rubyid_all_fields'>all_fields</span>
  <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_has_ids'>has_ids</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_hash_fields'>hash_fields</span><span class='period'>.</span><span class='id identifier rubyid_to_set'>to_set</span> <span class='op'>!=</span> <span class='id identifier rubyid_parent_ids'>parent_ids</span>

  <span class='comment'># If we&#39;re looking up from a previous step, only allow lookup by ID
</span>  <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>1</span> <span class='op'>&amp;&amp;</span>
                     <span class='id identifier rubyid_parent_index'>parent_index</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span> <span class='op'>!=</span> <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='rparen'>)</span> <span class='op'>||</span>
                     <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_hash_fields'>hash_fields</span> <span class='op'>==</span> <span class='id identifier rubyid_parent_ids'>parent_ids</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="last_fields?-class_method">
  
    .<strong>last_fields?</strong>(index, state)  &#x21d2; <tt>Boolean</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Check that we have the required fields to move on with the next lookup</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


148
149
150
151
152
153
154
155
156
157
158
159
160
161
162</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/plans/index_lookup.rb', line 148</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_last_fields?'>last_fields?</span><span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_index_includes'>index_includes</span> <span class='op'>=</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_fields'>fields</span><span class='op'>|</span>
    <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_all?'>all?</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_all_fields'>all_fields</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_f'>f</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='comment'># We must have either the ID or all the fields
</span>  <span class='comment'># for leaf entities in the original graph
</span>  <span class='id identifier rubyid_leaf_entities'>leaf_entities</span> <span class='op'>=</span> <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_entities'>entities</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_entity'>entity</span><span class='op'>|</span>
    <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_leaf_entity?'>leaf_entity?</span><span class='lparen'>(</span><span class='id identifier rubyid_entity'>entity</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_leaf_entities'>leaf_entities</span><span class='period'>.</span><span class='id identifier rubyid_all?'>all?</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_entity'>entity</span><span class='op'>|</span>
    <span class='id identifier rubyid_index_includes'>index_includes</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id identifier rubyid_entity'>entity</span><span class='period'>.</span><span class='id identifier rubyid_id_field'>id_field</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='op'>||</span>
      <span class='id identifier rubyid_index_includes'>index_includes</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_parent'>parent</span> <span class='op'>==</span> <span class='id identifier rubyid_entity'>entity</span> <span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="==-instance_method">
  
    #<strong>==</strong>(other)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='eql?-instance_method'>eql?</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Two index steps are equal if they use the same index</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


42
43
44</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/plans/index_lookup.rb', line 42</span>

<span class='kw'>def</span> <span class='op'>==</span><span class='lparen'>(</span><span class='id identifier rubyid_other'>other</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_instance_of?'>instance_of?</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@index</span> <span class='op'>==</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="range_order_prefix-instance_method">
  
    #<strong>range_order_prefix</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'><a href="../Fields/Field.html" title="NoSE::Fields::Field (class)">Fields::Field</a></span>&gt;</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get the set of fields which can be filtered by the ordered keys</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Array.html" title="Array (class)">Array</a></span>&lt;<span class='object_link'><a href="../Fields/Field.html" title="NoSE::Fields::Field (class)">Fields::Field</a></span>&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


176
177
178
179
180
181</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/plans/index_lookup.rb', line 176</span>

<span class='kw'>def</span> <span class='id identifier rubyid_range_order_prefix'>range_order_prefix</span>
  <span class='id identifier rubyid_order_prefix'>order_prefix</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_eq'>eq</span> <span class='op'>-</span> <span class='ivar'>@index</span><span class='period'>.</span><span class='id identifier rubyid_hash_fields'>hash_fields</span><span class='rparen'>)</span> <span class='op'>&amp;</span> <span class='ivar'>@index</span><span class='period'>.</span><span class='id identifier rubyid_order_fields'>order_fields</span>
  <span class='id identifier rubyid_order_prefix'>order_prefix</span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_range'>range</span> <span class='kw'>unless</span> <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_range'>range</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='id identifier rubyid_order_prefix'>order_prefix</span> <span class='op'>=</span> <span class='id identifier rubyid_order_prefix'>order_prefix</span><span class='period'>.</span><span class='id identifier rubyid_zip'>zip</span><span class='lparen'>(</span><span class='ivar'>@index</span><span class='period'>.</span><span class='id identifier rubyid_order_fields'>order_fields</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_order_prefix'>order_prefix</span><span class='period'>.</span><span class='id identifier rubyid_take_while'>take_while</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span> <span class='op'>==</span> <span class='id identifier rubyid_y'>y</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:first</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="resolve_order-instance_method">
  
    #<strong>resolve_order</strong>  &#x21d2; <tt>Boolean</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Perform any ordering implicit to this index</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>whether this index is by ID</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/plans/index_lookup.rb', line 185</span>

<span class='kw'>def</span> <span class='id identifier rubyid_resolve_order'>resolve_order</span>
  <span class='comment'># We can&#39;t resolve ordering if we&#39;re doing an ID lookup
</span>  <span class='comment'># since only one record exists per row (if it&#39;s the same entity)
</span>  <span class='comment'># We also need to have the fields used in order
</span>  <span class='id identifier rubyid_first_join'>first_join</span> <span class='op'>=</span> <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_join_order'>join_order</span><span class='period'>.</span><span class='id identifier rubyid_detect'>detect</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_entity'>entity</span><span class='op'>|</span>
    <span class='ivar'>@index</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_entities'>entities</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_entity'>entity</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_indexed_by_id'>indexed_by_id</span> <span class='op'>=</span> <span class='ivar'>@index</span><span class='period'>.</span><span class='id identifier rubyid_hash_fields'>hash_fields</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_first_join'>first_join</span><span class='period'>.</span><span class='id identifier rubyid_id_field'>id_field</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_order_prefix'>order_prefix</span> <span class='op'>=</span> <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_order_by'>order_by</span><span class='period'>.</span><span class='id identifier rubyid_longest_common_prefix'>longest_common_prefix</span><span class='lparen'>(</span>
    <span class='ivar'>@index</span><span class='period'>.</span><span class='id identifier rubyid_order_fields'>order_fields</span> <span class='op'>-</span> <span class='ivar'>@eq_filter</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
  <span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_indexed_by_id'>indexed_by_id</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_order_prefix'>order_prefix</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:parent</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_set'>to_set</span> <span class='op'>==</span>
                      <span class='const'>Set</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='ivar'>@index</span><span class='period'>.</span><span class='id identifier rubyid_hash_fields'>hash_fields</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_parent'>parent</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_order_prefix'>order_prefix</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_order_by'>order_by</span> <span class='op'>-=</span> <span class='id identifier rubyid_order_prefix'>order_prefix</span>
  <span class='kw'>end</span>
  <span class='ivar'>@order_by</span> <span class='op'>=</span> <span class='id identifier rubyid_order_prefix'>order_prefix</span>

  <span class='id identifier rubyid_indexed_by_id'>indexed_by_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="strip_graph-instance_method">
  
    #<strong>strip_graph</strong>  &#x21d2; <tt>void</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Strip the graph for this index, but if we haven&#39;t fetched all fields, leave the last one so we can perform a separate ID lookup</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/plans/index_lookup.rb', line 210</span>

<span class='kw'>def</span> <span class='id identifier rubyid_strip_graph'>strip_graph</span>
  <span class='id identifier rubyid_hash_entity'>hash_entity</span> <span class='op'>=</span> <span class='ivar'>@index</span><span class='period'>.</span><span class='id identifier rubyid_hash_fields'>hash_fields</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_parent'>parent</span>
  <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span> <span class='op'>=</span> <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_required_fields'>required_fields</span> <span class='op'>=</span> <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_fields_for_graph'>fields_for_graph</span><span class='lparen'>(</span><span class='ivar'>@index</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='comma'>,</span> <span class='id identifier rubyid_hash_entity'>hash_entity</span><span class='comma'>,</span>
                                            <span class='label'>select:</span> <span class='kw'>true</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_set'>to_set</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_required_fields'>required_fields</span><span class='period'>.</span><span class='id identifier rubyid_subset?'>subset?</span><span class='lparen'>(</span><span class='ivar'>@index</span><span class='period'>.</span><span class='id identifier rubyid_all_fields'>all_fields</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span>
     <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span> <span class='op'>==</span> <span class='ivar'>@index</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span>
    <span class='id identifier rubyid_removed_nodes'>removed_nodes</span> <span class='op'>=</span> <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_joins'>joins</span><span class='lbracket'>[</span><span class='int'>0</span><span class='op'>..</span><span class='ivar'>@index</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='rbracket'>]</span>
    <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_joins'>joins</span> <span class='op'>=</span> <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_joins'>joins</span><span class='lbracket'>[</span><span class='ivar'>@index</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_removed_nodes'>removed_nodes</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>1</span>
                      <span class='lbracket'>[</span><span class='rbracket'>]</span>
                    <span class='kw'>else</span>
                      <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_joins'>joins</span><span class='lbracket'>[</span><span class='int'>0</span><span class='op'>..</span><span class='ivar'>@index</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>-</span> <span class='int'>2</span><span class='rbracket'>]</span>
                    <span class='kw'>end</span>
    <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_joins'>joins</span> <span class='op'>=</span> <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_joins'>joins</span><span class='lbracket'>[</span><span class='ivar'>@index</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>-</span> <span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='comment'># Remove nodes which have been processed from the graph
</span>  <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_remove_nodes'>remove_nodes</span> <span class='id identifier rubyid_removed_nodes'>removed_nodes</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_color-instance_method">
  
    #<strong>to_color</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>:nocov:</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


31
32
33
34
35
36
37
38</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/plans/index_lookup.rb', line 31</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_color'>to_color</span>
  <span class='kw'>if</span> <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>super</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='ivar'>@index</span><span class='period'>.</span><span class='id identifier rubyid_to_color'>to_color</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>super</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='ivar'>@index</span><span class='period'>.</span><span class='id identifier rubyid_to_color'>to_color</span><span class='embexpr_end'>}</span><span class='tstring_content'> * </span><span class='tstring_end'>&quot;</span></span> \
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_cardinality'>cardinality</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_hash_cardinality'>hash_cardinality</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_cardinality-instance_method">
  
    #<strong>update_cardinality</strong>(parent, indexed_by_id)  &#x21d2; <tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Update the cardinality of this step, applying a limit if possible</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/plans/index_lookup.rb', line 233</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_cardinality'>update_cardinality</span><span class='lparen'>(</span><span class='id identifier rubyid_parent'>parent</span><span class='comma'>,</span> <span class='id identifier rubyid_indexed_by_id'>indexed_by_id</span><span class='rparen'>)</span>
  <span class='comment'># Calculate the new cardinality assuming no limit
</span>  <span class='comment'># Hash cardinality starts at 1 or is the previous cardinality
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_parent'>parent</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="RootPlanStep.html" title="NoSE::Plans::RootPlanStep (class)">RootPlanStep</a></span></span><span class='rparen'>)</span>
    <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_hash_cardinality'>hash_cardinality</span> <span class='op'>=</span> <span class='int'>1</span>
  <span class='kw'>else</span>
    <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_hash_cardinality'>hash_cardinality</span> <span class='op'>=</span> <span class='id identifier rubyid_parent'>parent</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_cardinality'>cardinality</span>
  <span class='kw'>end</span>

  <span class='comment'># Filter the total number of rows by filtering on non-hash fields
</span>  <span class='id identifier rubyid_cardinality'>cardinality</span> <span class='op'>=</span> <span class='ivar'>@index</span><span class='period'>.</span><span class='id identifier rubyid_per_hash_count'>per_hash_count</span> <span class='op'>*</span> <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_hash_cardinality'>hash_cardinality</span>
  <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_cardinality'>cardinality</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Cardinality.html" title="Cardinality (class)">Cardinality</a></span></span><span class='period'>.</span><span class='id identifier rubyid_filter'><span class='object_link'><a href="../../Cardinality.html#filter-class_method" title="Cardinality.filter (method)">filter</a></span></span> <span class='id identifier rubyid_cardinality'>cardinality</span><span class='comma'>,</span>
                                          <span class='ivar'>@eq_filter</span> <span class='op'>-</span>
                                          <span class='ivar'>@index</span><span class='period'>.</span><span class='id identifier rubyid_hash_fields'>hash_fields</span><span class='comma'>,</span>
                                          <span class='ivar'>@range_filter</span>

  <span class='comment'># Check if we can apply the limit from the query
</span>  <span class='comment'># This occurs either when we are on the first or last index lookup
</span>  <span class='comment'># and the ordering of the query has already been resolved
</span>  <span class='id identifier rubyid_order_resolved'>order_resolved</span> <span class='op'>=</span> <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_order_by'>order_by</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>1</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_answered?'>answered?</span><span class='lparen'>(</span><span class='label'>check_limit:</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='op'>||</span>
                <span class='id identifier rubyid_parent'>parent</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="RootPlanStep.html" title="NoSE::Plans::RootPlanStep (class)">RootPlanStep</a></span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_order_resolved'>order_resolved</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span>
                <span class='op'>!</span><span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_limit'>limit</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='comment'># XXX Assume that everything is limited by the limit value
</span>  <span class='comment'>#     which should be fine if the limit is small enough
</span>  <span class='ivar'>@limit</span> <span class='op'>=</span> <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_limit'>limit</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_parent'>parent</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="RootPlanStep.html" title="NoSE::Plans::RootPlanStep (class)">RootPlanStep</a></span></span><span class='rparen'>)</span>
    <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_cardinality'>cardinality</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='ivar'>@limit</span><span class='comma'>,</span> <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_cardinality'>cardinality</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_min'>min</span>
    <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_hash_cardinality'>hash_cardinality</span> <span class='op'>=</span> <span class='int'>1</span>
  <span class='kw'>else</span>
    <span class='ivar'>@limit</span> <span class='op'>=</span> <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_cardinality'>cardinality</span> <span class='op'>=</span> <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_limit'>limit</span>

    <span class='comment'># If this is a final lookup by ID, go with the limit
</span>    <span class='kw'>if</span> <span class='ivar'>@index</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>1</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_indexed_by_id'>indexed_by_id</span>
      <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_hash_cardinality'>hash_cardinality</span> <span class='op'>=</span> <span class='ivar'>@limit</span>
    <span class='kw'>else</span>
      <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_hash_cardinality'>hash_cardinality</span> <span class='op'>=</span> <span class='id identifier rubyid_parent'>parent</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_cardinality'>cardinality</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_state-instance_method">
  
    #<strong>update_state</strong>(parent)  &#x21d2; <tt>void</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Modify the state to reflect the fields looked up by the index</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nose/plans/index_lookup.rb', line 277</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_state'>update_state</span><span class='lparen'>(</span><span class='id identifier rubyid_parent'>parent</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_order_prefix'>order_prefix</span> <span class='op'>=</span> <span class='id identifier rubyid_range_order_prefix'>range_order_prefix</span><span class='period'>.</span><span class='id identifier rubyid_to_set'>to_set</span>

  <span class='comment'># Find fields which are filtered by the index
</span>  <span class='ivar'>@eq_filter</span> <span class='op'>=</span> <span class='ivar'>@index</span><span class='period'>.</span><span class='id identifier rubyid_hash_fields'>hash_fields</span> <span class='op'>+</span> <span class='lparen'>(</span><span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_eq'>eq</span> <span class='op'>&amp;</span> <span class='id identifier rubyid_order_prefix'>order_prefix</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_order_prefix'>order_prefix</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_range'>range</span><span class='rparen'>)</span>
    <span class='ivar'>@range_filter</span> <span class='op'>=</span> <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_range'>range</span>
    <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_range'>range</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>else</span>
    <span class='ivar'>@range_filter</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='comment'># Remove fields resolved by this index
</span>  <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_fields'>fields</span> <span class='op'>-=</span> <span class='ivar'>@index</span><span class='period'>.</span><span class='id identifier rubyid_all_fields'>all_fields</span>
  <span class='ivar'>@state</span><span class='period'>.</span><span class='id identifier rubyid_eq'>eq</span> <span class='op'>-=</span> <span class='ivar'>@eq_filter</span>

  <span class='id identifier rubyid_indexed_by_id'>indexed_by_id</span> <span class='op'>=</span> <span class='id identifier rubyid_resolve_order'>resolve_order</span>
  <span class='id identifier rubyid_strip_graph'>strip_graph</span>
  <span class='id identifier rubyid_update_cardinality'>update_cardinality</span> <span class='id identifier rubyid_parent'>parent</span><span class='comma'>,</span> <span class='id identifier rubyid_indexed_by_id'>indexed_by_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Thu Jul 16 13:54:47 2020 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.25 (ruby-2.7.0).
</div>

    </div>
  </body>
</html>